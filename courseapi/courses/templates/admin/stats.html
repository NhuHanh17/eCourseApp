{% extends "admin/base_site.html" %}
{% block extrastyle %}
<style>
    :root {
        --primary-color: #417690;
        --secondary-color: #79aec8;
        --accent-color: #f5dd5d;
        --bg-light: #f8f9fb;
    }

    .dashboard-container {
        font-family: "Roboto", "Lucida Grande", Verdana, sans-serif;
        padding: 20px;
        background-color: var(--bg-light);
    }

    .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: #fff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border-left: 6px solid var(--primary-color);
        transition: transform 0.2s;
    }

    .stat-card:hover { transform: translateY(-5px); }

    .stat-card h3 {
        margin: 0; color: #666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;
    }

    .stat-card .value {
        font-size: 1.8rem; font-weight: bold; color: var(--primary-color); margin-top: 10px; display: block;
    }

    .chart-row {
        display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;
    }

    .chart-container {
        background: #fff; padding: 20px; border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05); flex: 1; min-width: 450px;
    }

    .chart-container h2 {
        font-size: 1.1rem; margin-bottom: 20px; color: #444; border-bottom: 1px solid #eee; padding-bottom: 10px;
    }

    canvas { width: 100% !important; height: auto !important; }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1 style="margin-bottom: 30px; font-weight: 300;">üìä B√°o c√°o h·ªá th·ªëng</h1>

    <div class="summary-grid">
        <div class="stat-card">
            <h3>Doanh thu t·ªïng qu√°t</h3>
            <span class="value">{{ total_revenue|floatformat:"0g" }} VNƒê</span>
        </div>
        <div class="stat-card" style="border-left-color: var(--secondary-color);">
            <h3>Kh√≥a h·ªçc ƒë√£ m·ªü</h3>
            <span class="value">{{ total_courses }}</span>
        </div>
        <div class="stat-card" style="border-left-color: var(--accent-color);">
            <h3>T·ªïng s·ªë sinh vi√™n</h3>
            <span class="value">{{ total_students }}</span>
        </div>
    </div>

    <div class="chart-row">
        <div class="chart-container">
            <h2>üìà T·∫ßn su·∫•t ƒëƒÉng k√Ω (Theo th√°ng)</h2>
            <canvas id="lineChart"></canvas>
        </div>
        <div class="chart-container" style="flex: 0 0 350px;">
            <h2>üçï C∆° c·∫•u danh m·ª•c</h2>
            <canvas id="pieChart"></canvas>
        </div>
    </div>

    <div class="chart-row">
        <div class="chart-container">
            <h2>üèÜ Top 10 Kh√≥a h·ªçc thu h√∫t sinh vi√™n nh·∫•t</h2>
            <canvas id="barChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const chartOptions = {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
    };

    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: [{% for r in registration_trend %}"{{ r.month|date:'m/Y' }}",{% endfor %}],
            datasets: [{
                label: 'L∆∞·ª£t ƒëƒÉng k√Ω',
                data: [{% for r in registration_trend %}{{ r.count }},{% endfor %}],
                borderColor: '#417690',
                backgroundColor: 'rgba(65, 118, 144, 0.1)',
                fill: true, tension: 0.4
            }]
        },
        options: chartOptions
    });

   new Chart(document.getElementById('pieChart'), {
    type: 'doughnut',
    data: {
        labels: [{% for c in course_stats %}"{{ c.name }}",{% endfor %}],
        datasets: [{
            data: [{% for c in course_stats %}{{ c.count }},{% endfor %}],
            backgroundColor: ['#417690', '#79aec8', '#f5dd5d', '#e1e1e1', '#264b5d'],
            borderWidth: 0 // X√≥a ƒë∆∞·ªùng vi·ªÅn gi·ªØa c√°c mi·∫øng n·∫øu mu·ªën ph·∫≥ng ho√†n to√†n
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom',
            }
        },
        scales: {
            x: {
                display: false
            },
            y: {
                display: false
            }
        }
    }
});

    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: [{% for c in course_enrollment_details %}"{{ c.name }}",{% endfor %}],
            datasets: [{
                label: 'S·ªë l∆∞·ª£ng sinh vi√™n',
                data: [{% for c in course_enrollment_details %}{{ c.student_count }},{% endfor %}],
                backgroundColor: '#79aec8',
                borderRadius: 5
            }]
        },
        options: {
            ...chartOptions,
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
        }
    });
</script>
{% endblock %}